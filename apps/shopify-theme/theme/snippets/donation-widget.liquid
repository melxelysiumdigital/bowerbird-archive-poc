{%- comment -%}
  Renders donation widget with preset amount buttons and custom amount input.
  Works with both Horizon cart drawer and cart page.

  Usage:
    {% render 'donation-widget' %}
{%- endcomment -%}

{%- assign donation_product = settings.donation_product -%}
{%- if settings.donation_enabled and donation_product != blank -%}
  {%- assign donation_in_cart = false -%}
  {%- for item in cart.items -%}
    {%- if item.product.id == donation_product.id -%}
      {%- assign donation_in_cart = true -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}

  {%- unless donation_in_cart -%}
    {{ 'donation-widget.css' | asset_url | stylesheet_tag }}

    <donation-widget class="donation-widget">
      <div class="donation-widget__inner">
        {%- if settings.donation_heading != blank -%}
          <h3 class="donation-widget__heading">{{ settings.donation_heading }}</h3>
        {%- endif -%}
        {%- if settings.donation_description != blank -%}
          <p class="donation-widget__description">{{ settings.donation_description }}</p>
        {%- endif -%}

        <div class="donation-widget__amounts">
          {%- for variant in donation_product.variants -%}
            {%- if variant.price == 0 -%}
              <button
                type="button"
                class="donation-widget__amount-btn button--secondary"
                data-amount="custom"
                data-variant-id="{{ variant.id }}"
                aria-pressed="false"
              >
                Custom
              </button>
            {%- else -%}
              <button
                type="button"
                class="donation-widget__amount-btn button--secondary"
                data-amount="{{ variant.price | money_without_trailing_zeros | remove: '$' }}"
                data-variant-id="{{ variant.id }}"
                aria-pressed="false"
              >
                {{ variant.price | money_without_trailing_zeros }}
              </button>
            {%- endif -%}
          {%- endfor -%}
        </div>

        <div class="donation-widget__custom-input" hidden>
          <div class="donation-widget__field">
            <span class="donation-widget__currency-symbol">{{ cart.currency.symbol }}</span>
            <input
              type="number"
              class="donation-widget__input"
              min="1"
              step="1"
              placeholder="Enter amount"
              aria-label="Custom donation amount"
            >
          </div>
        </div>

        <button type="button" class="donation-widget__submit button" disabled>
          <span class="donation-widget__submit-text">Add donation</span>
          <span class="donation-widget__spinner" hidden>
            <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
            </svg>
          </span>
        </button>

        <div class="donation-widget__error" hidden role="alert"></div>
      </div>
    </donation-widget>

    <script src="{{ 'donation-widget.js' | asset_url }}" type="module"></script>
  {%- endunless -%}
{%- endif -%}
